# Cursor AI Rules for slack-reaction project

## プロジェクト概要
このプロジェクトは、Slackチャンネルのリアクション分析ツールです。

## 必須ルール

### コード品質チェック
- **コードを変更した後は、必ず `make lint` を実行してMarkdownファイルのlinterチェックを通過させること**
- **コミット前に `make check` を実行して、すべてのチェックがパスすることを確認すること**
- エラーが検出された場合は、修正してからコミットすること

### 開発原則
- **ドメイン駆動設計（DDD）**を前提に設計すること
  - ドメイン層、サービス層、インフラ層の分離を厳守すること
  - リポジトリパターンを使用してデータアクセスを抽象化すること
- **テスト駆動開発（TDD）**を心がけること
  - 新機能はテストファーストで実装すること
  - 既存のテストを壊さないこと
- セキュリティとパフォーマンスを最大限考慮すること

### Markdownファイル
- すべてのMarkdownファイルはmarkdownlintのルールに準拠すること
- コードブロックには言語指定を必ず含めること
- リストの前後には空行を入れること
- ファイルの末尾には改行を入れること

### コミット前チェック
コードを変更した後、コミットする前に以下を必ず実行すること：

```bash
make lint
```

または

```bash
make check
```

エラーが検出された場合は、`make lint-fix` で自動修正を試み、再度チェックすること。

### 作業終了時の必須確認事項
**すべてのコード変更作業の終わりに、以下を必ず確認すること：**

1. **テストの実行と確認**
   - `go test ./...` を実行して、すべてのテストが通過することを確認すること
   - 既存のテストが壊れていないことを確認すること
   - 新機能を追加した場合は、対応するテストコードも追加すること

2. **TDD（テスト駆動開発）の遵守**
   - 新機能を追加する場合は、まずテストを書き、その後実装すること
   - テストカバレッジを維持・向上させること
   - テスト可能な設計を心がけること（モック可能なインターフェースの使用など）

3. **既存アーキテクチャへの準拠**
   - **ドメイン駆動設計（DDD）**の原則に従うこと
     - `internal/domain/`: ドメインモデル（エンティティ、値オブジェクト）
     - `internal/service/`: ビジネスロジック（ユースケース）
     - `internal/infrastructure/`: インフラ層（外部API、データアクセス）
   - **リポジトリパターン**を使用すること
     - データアクセスはリポジトリインターフェースを通じて行うこと
     - ドメイン層はインフラ層に依存しないこと
   - レイヤー間の依存関係を正しく保つこと（ドメイン ← サービス ← インフラ）
   - 既存のコードスタイルとパターンに従うこと

### ドキュメント
- 新しい機能を追加した場合は、必要に応じてドキュメントを更新すること
- ドキュメントは `docs/` ディレクトリに配置すること
- **トラブルシューティング情報はREADMEには記載せず、必ず `docs/TROUBLESHOOTING.md` に記載すること**
  - READMEにはトラブルシューティングへのリンクのみを記載すること
  - トラブルシューティングの内容は `docs/` 配下のドキュメントにまとめること

### セキュリティ
- 機密情報（トークンなど）をコードにハードコードしないこと
- 環境変数を使用すること
- `.gitignore` に機密情報を含むファイルを追加すること

## 参考ドキュメント
- [コントリビューションガイドライン](docs/CONTRIBUTING.md)
- [Slackトークン取得方法](docs/slack-token-setup.md)
- [トラブルシューティング](docs/TROUBLESHOOTING.md)
